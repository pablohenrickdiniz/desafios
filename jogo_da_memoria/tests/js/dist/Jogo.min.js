var Jogo=React.createClass({displayName:"Jogo",mixins:[updateMixin,setIntervalMixin],propTypes:{id:React.PropTypes.string,dificuldade:React.PropTypes.number,baralho:React.PropTypes.object,baralhoUrl:React.PropTypes.string,cartao:React.PropTypes.object,ocupado:React.PropTypes.bool,matriz:React.PropTypes.object,pausado:React.PropTypes.bool,totalCartoes:React.PropTypes.number,cartoesVirados:React.PropTypes.number},getInitialState:function(){return{id:generateUUID(),dificuldade:1,baralho:null,baralhoUrl:"",
cartao:null,ocupado:!1,inicio:null,tempo:moment("0000-01-01 00:00:00"),matriz:new MatrizCartao(2,2),pausado:!1,cartoesVirados:0,totalCartoes:0}},carregarBaralho:function(b){var a=this;console.log(a.state);$.ajax({url:a.state.baralhoUrl,type:"post",dataType:"json",success:function(c){a.updateState({baralho:new Baralho(c)});b.apply(a)},error:function(){console.error("Verifique se a resposta est\u00e1 no formato json")}})},iniciar:function(){this.carregarMatriz();this.updateState({inicio:moment(),tempo:moment("0000-01-01 00:00:00")});
var b=this;this.setInterval("tick",function(){var a=b.state.tempo,a=a.add(1,"seconds");b.setState({tempo:a})},1E3)},pausar:function(){this.clearIntervals()},componentDidMount:function(){this.carregarBaralho(function(){this.iniciar()})},carregarMatriz:function(){if(null!=this.state.baralho){var b=new MatrizCartao(2*this.state.dificuldade,2*this.state.dificuldade),a=2*this.state.dificuldade*this.state.dificuldade*2,c=0,d=this.state.baralho.getPares();d.suffle();console.log(d);d.forEach(function(d){c<
a-1&&(b.add(d.cartaoA),b.add(d.cartaoB),c+=2)});b.suffle();this.updateState({matriz:b,totalCartoes:c})}},render:function(){var b=[],a=this,c=0,d=0;null!=a.state.baralho&&(c=a.state.baralho.altura,d=a.state.baralho.largura);var e={height:c*a.state.matriz.rows+10,width:d*a.state.matriz.cols+10};a.state.matriz.forEach(function(e,f){_.isObject(e)&&b.push(React.createElement(Cartao,React.__spread({},e,{key:f[0]+"-"+f[1],index:f,altura:c,largura:d,onClick:a.selecionarCartao})))});return React.createElement("div",
{id:this.state.id},React.createElement("div",{className:"memoria-container row",style:e},b),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("span",{className:"jogo-info"},"Tempo: ",this.state.tempo.format("HH:mm:ss")),React.createElement(AudioPlayer,{name:"audio"}))))},reiniciar:function(){var b=this,a=1;b.state.matriz.forEach(function(c,d,e){c instanceof Object&&(c.bloqueado=!0,setTimeout(function(){b.updateState({matriz:e})},100*
a),a++)});a+=10;setTimeout(function(){b.suffleAux()},100*a)},suffleAux:function(b,a){b=void 0==b?0:b;a=void 0==a?0:a;var c=this;a==c.state.matriz.cols&&(a=0,b++);if(b<c.state.matriz.rows){var d=Math.floor(Math.random()*c.state.matriz.rows),e=Math.floor(Math.random()*c.state.matriz.cols),d=c.state.matriz.get(d,e),e=c.state.matriz.get(b,a);if(d instanceof Cartao&&e instanceof Cartao){var g=$(d.slot).position().left,f=$(d.slot).position().top,h=$(e.slot).position().left,k=$(e.slot).position().top;$(d.slot).animate({left:h,
top:k},200);$(e.slot).animate({left:g,top:f},200,function(){c.suffleAux(b,a+1)})}else c.suffleAux(b,a+1)}else c.continuar()},continuar:function(){var b=this;b.state.pausado&&(this.setInterval("tick",function(){var a=null,a=null==b.state.tempo?moment("0000-01-01 00:00:00"):b.state.tempo,a=a.add(1,"seconds");b.updateState({tempo:a})},1E3),b.updateState({pausado:!1}))},isCompleto:function(){console.log(this.state);return this.state.cartoesVirados==this.state.totalCartoes},selecionarCartao:function(b){var a=
this;a.state.ocupado||(a.updateState({ocupado:!0}),null==a.state.cartao?b.updateState({virado:!0},function(){a.updateState({cartao:b,cartoesVirados:a.state.cartoesVirados+1},function(){setTimeout(function(){a.updateState({ocupado:!1})},500)})}):b!=a.state.cartao?b.updateState({virado:!0},function(){a.updateState({cartoesVirados:a.state.cartoesVirados+1},function(){setTimeout(function(){a.state.cartao.state.par==b.state.id||b.state.id==a.state.cartao.state.id?(console.log("passo sucesso"),b.updateState({bloqueado:!0},
function(){a.state.cartao.updateState({bloqueado:!0},function(){a.updateState({cartao:null});a.isCompleto()&&(a.pausar(),React.render(React.createElement(AlertModal,{id:"completo-modal",onConfirm:this.onCompleteConfirm,onClose:this.onCompleteClose,open:!0,layer:2}),document.getElementById("completo-container")))})})):(console.log("passo falha"),a.state.cartao.updateState({virado:!1}),setTimeout(function(){b.updateState({virado:!1})},200),a.updateState({cartao:null,cartoesVirados:a.state.cartoesVirados-
2}))},1E3);setTimeout(function(){a.updateState({ocupado:!1})},1E3)})}):(console.log("passo mesma carta!"),a.updateState({ocupado:!1})))},onCompleteConfirm:function(){},onCompleteClose:function(){}});
