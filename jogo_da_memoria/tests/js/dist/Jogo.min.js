var Jogo=React.createClass({displayName:"Jogo",mixins:[updateMixin,setIntervalMixin],propTypes:{id:React.PropTypes.string,dificuldade:React.PropTypes.number,baralho:React.PropTypes.object,baralhoUrl:React.PropTypes.string,cartao:React.PropTypes.object,ocupado:React.PropTypes.bool,matriz:React.PropTypes.object,pausado:React.PropTypes.bool,totalCartoes:React.PropTypes.number,cartoesVirados:React.PropTypes.number},getInitialState:function(){return{id:generateUUID(),dificuldade:1,baralho:null,baralhoUrl:"",
cartao:null,ocupado:!1,inicio:null,tempo:moment("0000-01-01 00:00:00"),matriz:new MatrizCartao(2,2),pausado:!1,cartoesVirados:0,totalCartoes:0}},carregarBaralho:function(b){var a=this;$.ajax({url:a.state.baralhoUrl,type:"post",dataType:"json",success:function(d){a.updateState({baralho:new Baralho(d)});b.apply(a)},error:function(){console.error("Verifique se a resposta est\u00e1 no formato json")}})},iniciar:function(){this.carregarMatriz();this.updateState({inicio:moment(),tempo:moment("0000-01-01 00:00:00")});
var b=this;this.setInterval("tick",function(){var a=b.state.tempo,a=a.add(1,"seconds");b.setState({tempo:a})},1E3)},pausar:function(){this.clearIntervals()},componentDidMount:function(){this.carregarBaralho(function(){this.iniciar()})},carregarMatriz:function(){if(null!=this.state.baralho){var b=new MatrizCartao(2*this.state.dificuldade,2*this.state.dificuldade),a=2*this.state.dificuldade*this.state.dificuldade*2,d=0,c=this.state.baralho.getPares();c.suffle();c.forEach(function(c){d<a-1&&(b.add(c.cartaoA),
b.add(c.cartaoB),d+=2)});b.suffle();this.updateState({matriz:b,totalCartoes:d})}},render:function(){var b=this,a=0,d=0;null!=b.state.baralho&&(a=b.state.baralho.altura,d=b.state.baralho.largura);var c={height:a*b.state.matriz.rows+10,width:d*b.state.matriz.cols+10},e=b.state.matriz.map(function(c,e){return _.isObject(c)?React.createElement(Cartao,React.__spread({},c,{key:e[0]+"-"+e[1],index:e,altura:a,largura:d,onClick:b.selecionarCartao})):null});return React.createElement("div",{id:this.state.id},
React.createElement("div",{className:"memoria-container row",style:c},e),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("span",{className:"jogo-info"},"Tempo: ",this.state.tempo.format("HH:mm:ss")),React.createElement(AudioPlayer,{name:"audio"}))))},allCardsToBack:function(b,a){var d=this;b=void 0==b?0:b;j=void 0==j?0:j;var c=d.state.matriz;j==c.cols&&(j=0,b++);if(b<c.rows){var e=c.get(b,j);e instanceof Object&&(e.virado=!1);d.updateState({matriz:c},
function(){setTimeout(function(){d.allCardsToBack(b,j+1)},200)})}else d.reiniciar()},reiniciar:function(){console.log("iniciar...");var b=this;b.state.matriz.recursiveFor(0,0,function(a,d,c){a instanceof Object&&(a.virado=!1);b.setState({matriz:c})},function(){b.state.matriz.recursiveFor(0,0,function(a,d,c){a=Math.floor(Math.random()*c.rows);var e=Math.floor(Math.random()*c.cols),f=c.get(a,e),g=c.get(d[0],d[1]);f instanceof Object&&g instanceof Object&&(c.set(d[0],d[1],f),c.set(a,e,g),b.setState({matriz:c}))},
function(a){a=a.map(function(a){a.bloqueado=!1;return a});b.setState({matriz:a})},200)},200)},continuar:function(){var b=this;b.state.pausado&&(this.setInterval("tick",function(){var a=null,a=null==b.state.tempo?moment("0000-01-01 00:00:00"):b.state.tempo,a=a.add(1,"seconds");b.updateState({tempo:a})},1E3),b.updateState({pausado:!1}))},isCompleto:function(){var b=0;this.state.matriz.forEach(function(a){a instanceof Object&&(b+=a.bloqueado?1:0)});return b==this.state.totalCartoes},selecionarCartao:function(b){var a=
this,d=a.state.matriz,c=d.get(b[0],b[1]);null==a.state.cartao?(console.log("primero passo"),c.bloqueado=!0,c.virado=!0,a.updateState({cartao:c,matriz:d})):a.state.cartao!=c?(c.virado=!0,a.setState({matriz:d},function(){setTimeout(function(){a.state.cartao.par==c.id||c.par==a.state.cartao.id?(c.bloqueado=!0,a.setState({cartao:null,matriz:d},function(){if(a.isCompleto()){var b={id:"alert-modal",open:!0,message:React.createElement("span",{className:"jogo-info"},"Tempo: ",a.state.tempo.format("HH:mm:ss")),
size:"modal-sm",type:"info",title:"Jogo Completo!",onClose:a.reiniciar};React.render(React.createElement(AlertModal,React.__spread({},b)),document.getElementById("completo-container"))}})):(a.state.cartao.virado=!1,a.setState({matriz:d}),setTimeout(function(){c.virado=!1;c.bloqueado=!1;a.state.cartao.bloqueado=!1;a.setState({matriz:d,cartao:null})},200))},1E3)})):console.log("mesmo cartao!")}});
